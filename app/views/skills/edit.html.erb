<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <%= stylesheet_link_tag 'custom', media: 'all', 'data-turbolinks-track': 'reload' %>

</head>
<body>

  <script>
    //学習時間の入力フォーム
      //vanilla jsで親要素探索する用の関数
      function getParents(el, parentSelector /* optional */) {
          if (parentSelector === undefined) {
              return false;
          }

          var p = el.parentNode;

          while (!p.classList.contains(parentSelector)) {
              var o = p;
              p = o.parentNode;
          }
          return p;
      }

      document.addEventListener('click',function(e){
        e = e || window.event;
        var target = e.target || e.srcElement,
            text = target.textContent || target.innerText;

        var val = 0;

        //クリックしたDOMが.js-time-select-upだったら
        if(target.classList.contains('js-time-select-up')){
          val = 1;
        } else if(target.classList.contains('js-time-select-down')) {
          val = -1;
        } else {
          return false;
        }
        var parent = getParents(target,'js-time-select-area');//親の.js-time-select-areaを取得して
        var input = parent.querySelectorAll('.js-time-select');//親の.js-time-select-areaの子の.js-time-selectを取得して
        //Nodelistを回す
        for (let i = 0; i < input.length; i++) {
          if(input[i].classList.contains('js-time-select')){
            //.js-time-select持ってるDOMに対して
            var num = parseInt(input[i].value);
            num = isNaN(num) ? 0 : num;
            input[i].value = num + val < 0 ? 0 : num + val;
          }
        }

      },false);

    //月選択で画面表示切り替え
      function viewChange(){
          if(document.getElementById('pull-down-button')){
              id = document.getElementById('pull-down-button').value;
              if(id == '<%= @current_month %>'){
                  document.getElementById('Box1').style.display = "";
                  document.getElementById('Box2').style.display = "none";
                  document.getElementById('Box3').style.display = "none";
              }else if(id == '<%= @last_month %>'){
                  document.getElementById('Box1').style.display = "none";
                  document.getElementById('Box2').style.display = "";
                  document.getElementById('Box3').style.display = "none";
              }
              else if(id == '<%= @two_months_ago %>'){
                  document.getElementById('Box1').style.display = "none";
                  document.getElementById('Box2').style.display = "none";
                  document.getElementById('Box3').style.display = "";
              }
          }

      window.onload = viewChange;
      }
  </script>

  <header>
    <h6><a href="<%= user_path(@user) %>">My Portfolio</a></h6>
    <%= link_to "ログアウト", logout_path, class: "button_logout", data: { "turbo-method": :delete } %>
  </header>
  <%= form_with model: @learning_data, url: user_skill_path(@user, @learning_data), method: :patch, local: true do |f| %>
    <div class="wrapper-skill">
      <div class="month-select-area">
        <select class="pull-down-button" id="pull-down-button" name="month" onchange="viewChange();">
          <option value="<%= @current_month %>"><%= @current_month %>月</option>
          <option value="<%= @last_month %>"><%= @last_month %>月</option>
          <option value="<%= @two_months_ago %>"><%= @two_months_ago %>月</option>
        </select>
      </div>

      <div id="Box1" class="select-box">
        <div class="category">
            <div class="content">
              <div class="title-group">
                <div class="title">バックエンド</div>
                <button class="button_blue">項目を追加する</button>
              </div>
                <table class="teble-group">
                  <thead>
                    <tr>
                      <th>項目名</th>
                      <th>学習時間</th>
                      <th></th>
                      <th></th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>Ruby</td>
                      <td>
                        <div class="time-select-area js-time-select-area">
                          <div class="__arrow __up js-time-select-up"></div>
                          <div class="__arrow __down js-time-select-down"></div>
                          <%= f.number_field :time, class:"time-select js-time-select", value: @learning_data.time || 0 %>
                        </div>
                      </td>
                      <td>
                        <%= f.submit "学習時間を保存する", class:"button-blue-save" %>
                      </td>
                      <td><button class="button-red">削除する</button></td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div id="Box2" class="select-box" style="display: none;">
          <p>two</p>
      </div>

      <div id="Box3" class="select-box" style="display: none;">
          <p>three</p>
      </div>
    </div>
  <% end %>
</body>
</html>
